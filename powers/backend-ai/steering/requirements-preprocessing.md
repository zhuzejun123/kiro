---
inclusion: always
---

# 需求预处理（非标需求 → 结构化需求）

## 概述

将各种非标准格式的需求输入（钉钉聊天、口头描述、零散文档等）转换为结构化的需求描述，为后续架构需求分析做准备。

---

## 支持的输入格式

| 输入类型 | 示例 | 处理方式 |
|----------|------|----------|
| 钉钉聊天记录 | 复制粘贴的群聊内容 | 提取关键信息，过滤噪音 |
| 钉钉文档 | 复制粘贴的文档内容 | 结构化整理 |
| 口头描述 | 用户直接描述需求 | 引导式提问补全 |
| 邮件内容 | 复制粘贴的邮件 | 提取核心需求 |
| 会议纪要 | 会议记录文本 | 提取决策和待办 |
| 混合内容 | 多种格式混合 | 分类处理后合并 |
| 图片 | 截图、原型图、流程图 | 需用户上传到聊天窗口 |

### 图片处理说明

**重要**: 无法直接访问外部图片 URL（如 `https://xxx.com/image.png`）

| 场景 | 处理方式 |
|------|----------|
| 需求文档中包含图片 URL | 请将图片下载后拖拽到聊天窗口上传 |
| 原型图/设计稿 | 请截图后上传到聊天窗口 |
| 流程图/架构图 | 请截图后上传，或提供文字描述 |
| 钉钉文档中的图片 | 请单独截图上传 |

**上传图片后可以分析**:
- 界面原型 → 提取功能点、按钮、输入框、交互逻辑
- 流程图 → 提取业务流程、状态流转、交互线条和箭头方向
- 表格截图 → 提取字段和数据结构
- 聊天截图 → 提取需求讨论内容
- 架构图 → 提取模块关系、数据流向、系统边界

**图片分析重点**:
| 图片类型 | 分析要点 |
|----------|----------|
| 流程图 | 节点名称、箭头方向、分支条件、开始/结束点 |
| 原型图 | 页面元素、按钮操作、表单字段、页面跳转 |
| 时序图 | 参与者、调用顺序、请求/响应、交互线条 |
| ER图 | 实体名称、字段、关系类型（1:1/1:N/N:N） |
| 架构图 | 模块划分、依赖关系、数据流向 |

---

## 处理流程

```
Step 1: 输入识别
    识别输入类型（聊天/文档/口头/混合）
    ↓
Step 2: 信息提取
    提取关键信息，过滤无关内容
    ↓
Step 3: 结构化整理
    整理为标准需求格式
    ↓
Step 4: 缺失检查
    列出不清晰/缺失的信息
    ↓
Step 5: 用户确认
    确认理解是否正确，补充缺失信息
```

---

## Step 1: 输入识别

### 识别特征

**钉钉聊天记录特征**:
- 包含时间戳（如 "14:30"、"昨天"）
- 包含人名/昵称
- 对话式内容，有问有答
- 可能包含 @某人、表情符号

**钉钉文档特征**:
- 有标题层级
- 相对完整的段落
- 可能有图片占位符 [图片]

**口头描述特征**:
- 无明显格式
- 第一人称描述
- 可能不完整

---

## Step 2: 信息提取

### 从聊天记录中提取

**需要提取的信息**:
```
1. 业务背景
   - 为什么要做这个功能？
   - 解决什么问题？

2. 核心功能点
   - 要做什么？
   - 有哪些操作？

3. 业务规则
   - 有什么限制条件？
   - 有什么特殊逻辑？

4. 参与角色
   - 谁来用？
   - 谁来管理？

5. 关联系统
   - 需要对接什么系统？
   - 数据从哪来？

6. 时间要求
   - 什么时候要？
   - 有没有分期？
```

**需要过滤的噪音**:
- 闲聊内容
- 重复确认（"好的"、"收到"）
- 无关讨论
- 表情符号

### 提取模板

```markdown
## 原始输入分析

### 识别到的输入类型
[聊天记录/文档/口头描述/混合]

### 参与讨论的人员
- [人员1]: [角色推测，如产品、开发、业务]
- [人员2]: [角色推测]

### 提取的关键信息

#### 业务背景
[从输入中提取的背景描述]

#### 核心功能点
1. [功能点1]
2. [功能点2]
3. [功能点3]

#### 业务规则/约束
1. [规则1]
2. [规则2]

#### 涉及角色
- [角色1]: [职责]
- [角色2]: [职责]

#### 关联系统/依赖
- [系统1]: [关联方式]
- [系统2]: [关联方式]

#### 提到的时间节点
- [时间点]: [内容]
```

---

## Step 3: 结构化整理

### 输出：结构化需求描述

```markdown
# [功能名称] 需求描述

## 1. 业务背景
[整理后的背景描述，2-3 句话]

## 2. 业务目标
- 目标1: [描述]
- 目标2: [描述]

## 3. 功能范围

### 3.1 核心功能
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 功能1 | 描述 | P0 |
| 功能2 | 描述 | P1 |

### 3.2 功能边界（不做什么）
- [明确不在范围内的功能]

## 4. 用户角色
| 角色 | 描述 | 主要操作 |
|------|------|----------|
| 角色1 | 描述 | 操作列表 |

## 5. 业务流程概述
[简要描述主要业务流程]

## 6. 业务规则
| 规则编号 | 规则描述 | 备注 |
|----------|----------|------|
| BR-001 | 规则描述 | - |

## 7. 外部依赖
| 依赖 | 类型 | 说明 |
|------|------|------|
| 依赖1 | 内部系统/外部API | 说明 |

## 8. 非功能性要求
- 性能: [要求]
- 安全: [要求]

## 9. 时间计划
- [里程碑]: [时间]
```

---

## Step 4: 缺失检查

### 必须明确的信息清单

| 类别 | 检查项 | 状态 |
|------|--------|------|
| 业务背景 | 为什么要做？ | ✅/❓ |
| 业务背景 | 解决什么问题？ | ✅/❓ |
| 功能范围 | 核心功能有哪些？ | ✅/❓ |
| 功能范围 | 边界在哪里？ | ✅/❓ |
| 用户角色 | 谁来使用？ | ✅/❓ |
| 业务规则 | 有什么限制？ | ✅/❓ |
| 外部依赖 | 需要对接什么？ | ✅/❓ |
| 时间要求 | 什么时候要？ | ✅/❓ |

### 缺失信息提问模板

```markdown
## 需要补充的信息

根据您提供的内容，以下信息不够清晰，请帮忙补充：

### 必须补充（影响核心设计）
1. ❓ [问题1]
   - 背景: [为什么需要这个信息]
   - 建议: [如果有默认建议]

2. ❓ [问题2]
   - 背景: [为什么需要这个信息]

### 建议补充（影响细节设计）
3. ❓ [问题3]
4. ❓ [问题4]

### 可选补充（锦上添花）
5. ❓ [问题5]
```

---

## Step 5: 用户确认

### 确认模板

```markdown
## 需求理解确认

我整理了您的需求，请确认以下理解是否正确：

### 核心理解
1. **做什么**: [一句话描述]
2. **为什么做**: [一句话描述]
3. **给谁用**: [角色列表]

### 主要功能点
- [x] 功能1
- [x] 功能2
- [x] 功能3

### 关键业务规则
- [x] 规则1
- [x] 规则2

### 我的疑问
1. [疑问1]
2. [疑问2]

---

**请确认**:
- 以上理解是否正确？
- 疑问部分请帮忙解答
- 还有什么补充？

确认后，我将开始生成架构需求文档。
```

---

## 示例：钉钉聊天记录处理

### 输入示例
```
张三 14:30
@李四 那个发票的功能什么时候能做？业务那边催得紧

李四 14:32
什么发票功能？

张三 14:33
就是让用户能在APP上申请开发票，然后财务审核通过后开票

李四 14:35
哦，这个啊。需要对接税务系统吗？

张三 14:36
要的，开票要调税务局的接口
还有，金额超过1万的要经理审批

李四 14:38
好的，大概什么时候要？

张三 14:40
下个月15号前要上线
```

### 处理输出
```markdown
## 需求理解确认

我整理了您的需求，请确认以下理解是否正确：

### 核心理解
1. **做什么**: APP 端发票申请功能
2. **为什么做**: 业务需求，用户需要在线申请开票
3. **给谁用**: 普通用户（申请）、财务（审核）、经理（大额审批）

### 主要功能点
- [x] 用户在 APP 申请开发票
- [x] 财务审核发票申请
- [x] 金额超过 1 万需经理审批
- [x] 审核通过后调用税务系统开票

### 关键业务规则
- [x] 金额 > 10000 元需要经理审批

### 外部依赖
- [x] 税务局开票接口

### 时间要求
- [x] 下个月 15 号前上线

---

### 我的疑问
1. 发票类型有哪些？（增值税普票/专票？）
2. 申请时需要填写哪些信息？（抬头、税号、金额？）
3. 一个订单可以开多张发票吗？
4. 税务系统接口文档有吗？

确认后，我将开始生成架构需求文档。
```

---

## 与后续阶段的衔接

需求预处理完成并确认后，输出的"结构化需求描述"将作为 Phase 1（架构需求分析）的输入。

```
Phase 0: 需求预处理 ← 当前阶段
    非标需求 → 结构化需求描述
    ↓ 用户确认
Phase 1: 架构需求分析
    结构化需求 → 架构需求文档
    ...
```
